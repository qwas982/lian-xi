/**
 * 工具函数.h
 * WebAssembly 工具函数声明
 * LEB128编解码、辅助函数
 * 对应原 utils.h
 */

#ifndef 工具函数_H
#define 工具函数_H

#include "枚举定义.h"
#include "类型定义.h"

/* ==================== LEB128 解码函数 ==================== */

/**
 * 解码LEB128无符号32位整数
 * @param 字节码 字节码数组
 * @param 偏移 起始偏移
 * @param 输出值 输出参数，解码后的值
 * @return 新的偏移位置，失败返回0
 */
uint32_t 解码无符号32位(uint8_t* 字节码, uint32_t 偏移, uint32_t* 输出值);

/**
 * 解码LEB128无符号64位整数
 * @param 字节码 字节码数组
 * @param 偏移 起始偏移
 * @param 输出值 输出参数，解码后的值
 * @return 新的偏移位置，失败返回0
 */
uint32_t 解码无符号64位(uint8_t* 字节码, uint32_t 偏移, uint64_t* 输出值);

/**
 * 解码LEB128有符号32位整数
 * @param 字节码 字节码数组
 * @param 偏移 起始偏移
 * @param 输出值 输出参数，解码后的值
 * @return 新的偏移位置，失败返回0
 */
uint32_t 解码有符号32位(uint8_t* 字节码, uint32_t 偏移, int32_t* 输出值);

/**
 * 解码LEB128有符号64位整数
 * @param 字节码 字节码数组
 * @param 偏移 起始偏移
 * @param 输出值 输出参数，解码后的值
 * @return 新的偏移位置，失败返回0
 */
uint32_t 解码有符号64位(uint8_t* 字节码, uint32_t 偏移, int64_t* 输出值);

/* ==================== LEB128 编码函数 ==================== */

/**
 * 编码无符号32位整数为LEB128
 * @param 值 要编码的值
 * @param 输出缓冲区 输出缓冲区
 * @return 编码后的字节数
 */
uint32_t 编码无符号32位(uint32_t 值, uint8_t* 输出缓冲区);

/**
 * 编码有符号32位整数为LEB128
 * @param 值 要编码的值
 * @param 输出缓冲区 输出缓冲区
 * @return 编码后的字节数
 */
uint32_t 编码有符号32位(int32_t 值, uint8_t* 输出缓冲区);

/**
 * 编码无符号64位整数为LEB128
 * @param 值 要编码的值
 * @param 输出缓冲区 输出缓冲区
 * @return 编码后的字节数
 */
uint32_t 编码无符号64位(uint64_t 值, uint8_t* 输出缓冲区);

/**
 * 编码有符号64位整数为LEB128
 * @param 值 要编码的值
 * @param 输出缓冲区 输出缓冲区
 * @return 编码后的字节数
 */
uint32_t 编码有符号64位(int64_t 值, uint8_t* 输出缓冲区);

/* ==================== 浮点转换函数 ==================== */

/**
 * 单精度浮点数转32位有符号整数
 * @param 值 浮点值
 * @param 输出 输出参数
 * @return 错误码
 */
int 单精度转32位有符号(float 值, int32_t* 输出);

/**
 * 单精度浮点数转32位无符号整数
 * @param 值 浮点值
 * @param 输出 输出参数
 * @return 错误码
 */
int 单精度转32位无符号(float 值, uint32_t* 输出);

/**
 * 双精度浮点数转32位有符号整数
 * @param 值 浮点值
 * @param 输出 输出参数
 * @return 错误码
 */
int 双精度转32位有符号(double 值, int32_t* 输出);

/**
 * 双精度浮点数转32位无符号整数
 * @param 值 浮点值
 * @param 输出 输出参数
 * @return 错误码
 */
int 双精度转32位无符号(double 值, uint32_t* 输出);

/**
 * 单精度浮点数转64位有符号整数
 * @param 值 浮点值
 * @param 输出 输出参数
 * @return 错误码
 */
int 单精度转64位有符号(float 值, int64_t* 输出);

/**
 * 单精度浮点数转64位无符号整数
 * @param 值 浮点值
 * @param 输出 输出参数
 * @return 错误码
 */
int 单精度转64位无符号(float 值, uint64_t* 输出);

/**
 * 双精度浮点数转64位有符号整数
 * @param 值 浮点值
 * @param 输出 输出参数
 * @return 错误码
 */
int 双精度转64位有符号(double 值, int64_t* 输出);

/**
 * 双精度浮点数转64位无符号整数
 * @param 值 浮点值
 * @param 输出 输出参数
 * @return 错误码
 */
int 双精度转64位无符号(double 值, uint64_t* 输出);

/* ==================== 饱和截断函数 ==================== */

/**
 * 饱和截断到32位有符号整数
 * @param 值 浮点值
 * @return 截断后的整数值
 */
int32_t 截断饱和32位有符号(double 值);

/**
 * 饱和截断到32位无符号整数
 * @param 值 浮点值
 * @return 截断后的整数值
 */
uint32_t 截断饱和32位无符号(double 值);

/**
 * 饱和截断到64位有符号整数
 * @param 值 浮点值
 * @return 截断后的整数值
 */
int64_t 截断饱和64位有符号(double 值);

/**
 * 饱和截断到64位无符号整数
 * @param 值 浮点值
 * @return 截断后的整数值
 */
uint64_t 截断饱和64位无符号(double 值);

/* ==================== 浮点辅助函数 ==================== */

/**
 * 复制浮点符号位
 * @param 目标 目标浮点数
 * @param 源 源浮点数
 * @return 复制符号后的值
 */
float 复制单精度符号(float 目标, float 源);
double 复制双精度符号(double 目标, double 源);

/**
 * 浮点最小值（处理NaN）
 */
float 单精度最小值(float 甲, float 乙);
double 双精度最小值(double 甲, double 乙);

/**
 * 浮点最大值（处理NaN）
 */
float 单精度最大值(float 甲, float 乙);
double 双精度最大值(double 甲, double 乙);

/**
 * 检查是否为NaN
 */
int 是单精度NaN(float 值);
int 是双精度NaN(double 值);

/* ==================== 块类型辅助函数 ==================== */

/**
 * 根据块类型获取返回类型
 * @param 块类型 块类型字节
 * @return 返回类型（值类型_xxx），0xFF表示无返回值
 */
uint8_t 获取块返回类型(uint8_t 块类型);

/**
 * 检查块类型是否有返回值
 * @param 块类型 块类型字节
 * @return 1有返回值，0无返回值
 */
int 块类型有返回值(uint8_t 块类型);

/* ==================== 错误消息函数 ==================== */

/**
 * 获取错误码对应的错误消息
 * @param 错误码 错误码
 * @return 错误消息字符串
 */
const char* 获取错误消息(int 错误码);

/* ==================== 字节序辅助函数 ==================== */

/**
 * 从小端序字节数组读取16位无符号整数
 */
uint16_t 读取小端16位(uint8_t* 数据);

/**
 * 从小端序字节数组读取32位无符号整数
 */
uint32_t 读取小端32位(uint8_t* 数据);

/**
 * 从小端序字节数组读取64位无符号整数
 */
uint64_t 读取小端64位(uint8_t* 数据);

/**
 * 向小端序字节数组写入16位无符号整数
 */
void 写入小端16位(uint8_t* 数据, uint16_t 值);

/**
 * 向小端序字节数组写入32位无符号整数
 */
void 写入小端32位(uint8_t* 数据, uint32_t 值);

/**
 * 向小端序字节数组写入64位无符号整数
 */
void 写入小端64位(uint8_t* 数据, uint64_t 值);

#endif /* 工具函数_H */
