# Makefile - WebAssembly解释器构建脚本 (Unix/Linux/MacOS)

# 编译器设置
编译器 = gcc
编译选项 = -std=c89 -Wall -Wextra -pedantic -O2
调试选项 = -std=c89 -Wall -Wextra -pedantic -g -O0

# 输出名称
输出名 = wasm解释器

# 源文件
源文件们 = 数据结构.c 工具函数.c 模块加载器.c 解释器核心.c 主程序.c
头文件们 = 枚举定义.h 类型定义.h 数据结构.h 工具函数.h 模块加载器.h 解释器核心.h

# 默认目标
.PHONY: 全部 调试 清理 测试 帮助

全部: $(输出名)

# 发布版本
$(输出名): $(源文件们) $(头文件们)
	@echo "========================================"
	@echo "构建 WebAssembly解释器 (发布版本)"
	@echo "========================================"
	$(编译器) $(编译选项) -o $(输出名) $(源文件们)
	@echo "构建完成: $(输出名)"

# 调试版本
调试: $(源文件们) $(头文件们)
	@echo "========================================"
	@echo "构建 WebAssembly解释器 (调试版本)"
	@echo "========================================"
	$(编译器) $(调试选项) -o $(输出名)_调试 $(源文件们)
	@echo "构建完成: $(输出名)_调试"

# 运行测试
test: $(输出名)
	@echo "========================================"
	@echo "运行内置测试"
	@echo "========================================"
	./$(输出名) --测试

# 清理构建产物
清理:
	@echo "清理构建产物..."
	rm -f $(输出名) $(输出名)_调试 *.o
	@echo "清理完成"

# 显示帮助
帮助:
	@echo "========================================"
	@echo "WebAssembly解释器 C89版本 构建系统"
	@echo "========================================"
	@echo ""
	@echo "可用目标:"
	@echo "  make        - 构建发布版本"
	@echo "  make 调试   - 构建调试版本"
	@echo "  make test   - 运行内置测试"
	@echo "  make 清理   - 清理构建产物"
	@echo "  make 帮助   - 显示此帮助信息"
	@echo ""
	@echo "使用方法:"
	@echo "  ./$(输出名) --测试           运行内置测试"
	@echo "  ./$(输出名) <wasm文件>       加载并执行Wasm模块"
	@echo "  ./$(输出名) --帮助           显示帮助信息"
